apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  labels:
    app: nginx-ingress-controller
    app.kubernetes.io/name: ft-transcendence
    app.kubernetes.io/part-of: ft-transcendence
    app.kubernetes.io/component: nginx-ingress-controller
data:
  # Configuration générale Nginx
  enable-ssl-passthrough: 'false'
  enable-vts-status: 'true'
  log-format-upstream: |
    $remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time [$proxy_upstream_name] [$proxy_alternative_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id
  use-forwarded-headers: 'true'
  compute-full-forwarded-for: 'true'
  use-proxy-protocol: 'false'
  # Limites de taille
  proxy-body-size: '10m'
  client-body-buffer-size: '128k'
  # Timeouts
  proxy-connect-timeout: '60'
  proxy-send-timeout: '60'
  proxy-read-timeout: '60'
  # Worker processes
  worker-processes: 'auto'
  max-worker-connections: '16384'
  # Gzip
  enable-gzip: 'true'
  gzip-types: 'application/json application/javascript application/xml text/css text/javascript text/plain text/xml'
  # Rate limiting
  limit-conn-zone-variable: '$binary_remote_addr'
  # ModSecurity (peut être activé via overlay si une image avec ModSecurity est utilisée)
  # Note: L'image officielle nginx-ingress-controller ne supporte pas ModSecurity nativement
  # Pour activer ModSecurity, utiliser une image personnalisée ou un sidecar
